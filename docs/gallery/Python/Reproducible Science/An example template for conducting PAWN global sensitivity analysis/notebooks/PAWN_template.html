

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>First install PRMS-Python if you haven’t already &mdash; CUAHSI Gallery</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster.custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster.bundle.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster-sideTip-shadow.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster-sideTip-punk.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster-sideTip-noir.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster-sideTip-light.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/tooltipster-sideTip-borderless.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/micromodal.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/sphinx_rtd_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/contentui.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
        <script src="../../../../../_static/js/hoverxref.js"></script>
        <script src="../../../../../_static/js/tooltipster.bundle.min.js"></script>
        <script src="../../../../../_static/js/micromodal.min.js"></script>
        <script src="../../../../../_static/js/custom.js"></script>
        <script src="../../../../../_static/contentui.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html">
          

          
            
            <img src="../../../../../_static/cuahsi-logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Galleries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#research-examples">Research Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#reproducible-science-examples">Reproducible Science Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#instructional-examples">Instructional Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../R/index.html">R</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../R/index.html#instructional-examples">Instructional Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../RShiny/index.html">RShiny</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../RShiny/index.html#research-examples">Research Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../RShiny/index.html#instructional-examples">Instructional Examples</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">BuildDocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <!--
The purpose of this template is to override (i.e. supress) the breadcrumbs that appear at the top of each page.
-->


          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="First-install-PRMS-Python-if-you-haven’t-already">
<h1>First install PRMS-Python if you haven’t already<a class="headerlink" href="#First-install-PRMS-Python-if-you-haven’t-already" title="Permalink to this headline">¶</a></h1>
<p>This template demsontrates the use of the open–source Python package <a class="reference external" href="http://prms-python.github.io/PRMS-Python/">PRMS-Python</a>. To install PRMS-Python we recommend using the Python Package installer, pip</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install prms-python
</pre></div>
</div>
<p>Alternatively, the most current version of PRMS-Python is available on <a class="reference external" href="https://github.com/PRMS-Python/PRMS-Python">GitHub</a> and you can download it there or use git clone</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/PRMS-Python/PRMS-Python.git
</pre></div>
</div>
<p>If you decide to install from GitHub and want your PRMS-Python available on your Python PATH, from the PRMS-Python directory run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install --editable .
</pre></div>
</div>
</div>
<div class="section" id="Example-workflow-of-the-PAWN-global-sensitivity-analysis-method-using-PRMS-Python-on-three-arbitrary-PRMS-parameters">
<h1>Example workflow of the PAWN global sensitivity analysis method using PRMS-Python on three arbitrary PRMS parameters<a class="headerlink" href="#Example-workflow-of-the-PAWN-global-sensitivity-analysis-method-using-PRMS-Python-on-three-arbitrary-PRMS-parameters" title="Permalink to this headline">¶</a></h1>
<p>The PAWN global, moment-independent, sensitivity analysis (SA) method is relatively straightforward to implement for any PRMS parameter using PRMS-Python objects. The research paper that describes PAWN is found More information on the PAWN method can be found <a class="reference external" href="http://dx.doi.org/10.1016/j.envsoft.2015.01.004">here</a>. This example template can be modified to create the data necessary (emprical CDFs) for PAWN on any number of physical PRMS parameters for any PRMS model. A case study using a
slightly modified version of this script was used to conduct PAWN SA on 8 parameters that comprise the degree-day solar radiation module in PRMS, details can be found in the PRMS-Python research paper <a href="#id1"><span class="problematic" id="id2">`here &lt;&gt;`__</span></a>. The control parameters and variable names for the experimental setup of PAWN as stated in the PAWN and PRMS-Python papers are used within this code template, similarly this example code is heavily commented for clarity.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># import necessary modules for PAWN</span>
<span class="kn">from</span> <span class="nn">prms_python</span> <span class="kn">import</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Optimizer</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">prms_python.optimizer</span> <span class="kn">import</span> <span class="n">OptimizationResult</span>
<span class="kn">from</span> <span class="nn">prms_python.optimizer</span> <span class="kn">import</span> <span class="n">resample_param</span> <span class="k">as</span> <span class="n">resample</span>
</pre></div>
</div>
</div>
<div class="section" id="Define-paths-to-initial-model-inputs,-measured-data,-and-initialize-input-objects">
<h2>Define paths to initial model inputs, measured data, and initialize input objects<a class="headerlink" href="#Define-paths-to-initial-model-inputs,-measured-data,-and-initialize-input-objects" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">param_path</span> <span class="s1">&#39;path/to/model/parameters&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s1">&#39;path/to/model/data&#39;</span><span class="p">)</span> <span class="c1"># this example does not modify climate forcing so a single instance is fine</span>
<span class="n">control_path</span> <span class="o">=</span> <span class="s1">&#39;path/to/model/control&#39;</span>
<span class="n">work_directory</span> <span class="o">=</span> <span class="s1">&#39;path/to/output/directory&#39;</span>
<span class="n">measrd_path</span> <span class="o">=</span> <span class="s1">&#39;path/to/measured/output.csv&#39;</span>
<span class="n">PRMS_output_variable</span> <span class="o">=</span> <span class="s1">&#39;name_of_PRMS_output_variable_for_SA&#39;</span> <span class="c1"># e.g. &quot;basin runoff 1&quot; or Y in PAWN</span>
</pre></div>
</div>
</div>
<p>Note, to avoid platform specific path errors use os.path.join() as opposed to strings with platform path separators. For example if the path to the control file is $HOME/prms/control then use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span>
<span class="n">control_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home</span><span class="p">,</span> <span class="s1">&#39;prms&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Define-sampling-method,-optimization-title,-and-experimental-setup-control-parameters">
<h2>Define sampling method, optimization title, and experimental setup control parameters<a class="headerlink" href="#Define-sampling-method,-optimization-title,-and-experimental-setup-control-parameters" title="Permalink to this headline">¶</a></h2>
<p>This example uses the uniform distribution to resample parameter values over their entire domain as described by the PRMS user manual. Alternatively you could use a smaller domain from the uniform distribution by changing <code class="docutils literal notranslate"><span class="pre">prms_python.optimizer.param_ranges</span></code> or you could use a normal random variable as described <a class="reference external" href="https://github.com/PRMS-Python/PRMS-Python/blob/master/notebooks/monte_carlo_param_resampling.ipynb">here</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">resample_meth</span> <span class="o">=</span> <span class="s1">&#39;uniform&#39;</span> <span class="c1"># sampling parameter values from a uniform distribution</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;ddsolrad_PAWN&#39;</span> <span class="c1"># title optional</span>
<span class="n">nprocs</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># number of physical or logical processing cores to use</span>

<span class="c1"># PAWN related experimental setup variables</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># number of input factors for SA (parameters in this case)</span>
<span class="n">Nuc</span> <span class="o">=</span> <span class="mi">4000</span> <span class="c1"># number of simulations to build the unconditional CDF</span>
<span class="n">Nc</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># number of times to resample each conditioning parameter</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of simulations for buidling each conditional CDF</span>

<span class="c1"># stages are used by the Optimizer object,</span>
<span class="c1"># in PAWN these are essentially the names of each input factor 1,2,...,M</span>
<span class="n">stage_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unconditional&#39;</span><span class="p">,</span> <span class="s1">&#39;cond_p1&#39;</span><span class="p">,</span> <span class="s1">&#39;cond_p2&#39;</span><span class="p">,</span> <span class="s1">&#39;cond_p3&#39;</span><span class="p">]</span>
<span class="c1"># each conditional stage is the exclusion of 1 of the 3 input parameters which is held &#39;constant&#39; Nc times</span>
<span class="n">param_names_for_each_stage</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="p">[</span><span class="s1">&#39;p1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;p2_name&#39;</span><span class="p">,</span> <span class="s1">&#39;p3_name&#39;</span><span class="p">],</span>
                                <span class="p">[</span><span class="s1">&#39;p2_name&#39;</span><span class="p">,</span> <span class="s1">&#39;p3_name&#39;</span><span class="p">],</span>
                                <span class="p">[</span><span class="s1">&#39;p1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;p3_name&#39;</span><span class="p">],</span>
                                <span class="p">[</span><span class="s1">&#39;p1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;p2_name&#39;</span><span class="p">]</span>
                             <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Conduct-Nuc-simulations-on-all-M-parameters-to-build-the-unconditional-CDF">
<h2>Conduct Nuc simulations on all M parameters to build the unconditional CDF<a class="headerlink" href="#Conduct-Nuc-simulations-on-all-M-parameters-to-build-the-unconditional-CDF" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stage_name</span> <span class="o">=</span> <span class="n">stage_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># &quot;unconditional&quot;</span>
<span class="c1"># create an Optimizer instance and call monte_carlo method</span>
<span class="n">optr</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span><span class="n">Parameters</span><span class="p">(</span><span class="n">param_path</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">control_path</span><span class="p">,</span> <span class="n">work_directory</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">optr</span><span class="o">.</span><span class="n">monte_carlo</span><span class="p">(</span>
                 <span class="n">measured_path</span><span class="p">,</span>
                 <span class="n">param_names_for_each_stage</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">PRMS_output_variable</span><span class="p">,</span>
                 <span class="n">method</span><span class="o">=</span><span class="n">resample_meth</span><span class="p">,</span>
                 <span class="n">n_sims</span><span class="o">=</span><span class="n">Nuc</span><span class="p">,</span>
                 <span class="n">nproc</span><span class="o">=</span><span class="n">nprocs</span><span class="p">,</span>
                 <span class="n">stage</span><span class="o">=</span><span class="n">stage_name</span>
                 <span class="p">)</span>
<span class="c1"># optionally archive output to reduce disk space</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">OptimizationResult</span><span class="p">(</span><span class="n">work_directory</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="n">stage_name</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">archive</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-conditional-CDFs-Nc-times-for-each-parameter,-storing-conditioning-parameter-values">
<h2>Create conditional CDFs Nc times for each parameter, storing conditioning parameter values<a class="headerlink" href="#Create-conditional-CDFs-Nc-times-for-each-parameter,-storing-conditioning-parameter-values" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nc</span><span class="p">):</span> <span class="c1"># number of conditional param bootstraps- distributable to multiple machines/nodes</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stage_names</span><span class="p">):</span> <span class="c1"># xi param of M total params</span>
        <span class="k">if</span> <span class="n">stage</span><span class="o">==</span><span class="s1">&#39;unconditional&#39;</span><span class="p">:</span> <span class="c1"># already built unconditional CDF- skip</span>
            <span class="k">continue</span>
        <span class="c1"># use unconditional param set minus conditioning param set to find conditioning param name</span>
        <span class="n">conditional_param</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stage_names</span><span class="p">[</span><span class="s1">&#39;unconditional&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">stage_names</span><span class="p">[</span><span class="n">stage</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># make a Parameter instance to resample the conditioning param</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">param_path</span><span class="p">)</span>
        <span class="n">xi_values</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">conditional_param</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="n">conditional_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi_values</span> <span class="c1"># assign resampled conditioning parameter (xi) to Parameter object</span>
        <span class="n">stage_name</span> <span class="o">=</span> <span class="n">stage</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span> <span class="c1"># add nc for nc&#39;th bootstrap resampling round</span>
        <span class="c1"># initialize an Optimizer object and call monte_carlo</span>
        <span class="n">optr</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span>
                         <span class="n">params</span><span class="p">,</span>
                         <span class="n">data</span><span class="p">,</span>
                         <span class="n">control_path</span><span class="p">,</span>
                         <span class="n">work_directory</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Conditioning value(s) for </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                          <span class="n">conditional_param</span><span class="p">,</span> <span class="n">xi_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                         <span class="p">)</span> <span class="c1"># track the parameter conditioning value for post-processing</span>
        <span class="n">optr</span><span class="o">.</span><span class="n">monte_carlo</span><span class="p">(</span>
                         <span class="n">measured_path</span><span class="p">,</span>
                         <span class="n">param_names_for_each_stage</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                         <span class="n">PRMS_output_variable</span><span class="p">,</span>
                         <span class="n">method</span><span class="o">=</span><span class="n">resample_meth</span><span class="p">,</span>
                         <span class="n">n_sims</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                         <span class="n">nproc</span><span class="o">=</span><span class="n">nprocs</span><span class="p">,</span>
                         <span class="n">stage</span><span class="o">=</span><span class="n">stage_name</span>
                         <span class="p">)</span>
        <span class="c1"># optionally archive output to reduce disk space</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">OptimizationResult</span><span class="p">(</span><span class="n">work_directory</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="n">stage_name</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">archive</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="That’s-it,-now-calculate-sensitivity-indices-for-each-input-parameter">
<h2>That’s it, now calculate sensitivity indices for each input parameter<a class="headerlink" href="#That’s-it,-now-calculate-sensitivity-indices-for-each-input-parameter" title="Permalink to this headline">¶</a></h2>
<p>Although this example does not include analysis of results, it is straightforward to build output CDFs from the archived JSON files. For example of accessing output from these files please refer to the Jupyter Notebook that packs with PRMS-Python for the <code class="docutils literal notranslate"><span class="pre">OptimizationResult</span></code> object <a class="reference external" href="https://github.com/PRMS-Python/PRMS-Python/blob/master/notebooks/monte_carlo_optimization_result.ipynb">here</a>. For convenience we added Python functions that calculate emprical CDFs and the Kolmogorov-Smirnov
distance between two CDFs specifically the <code class="docutils literal notranslate"><span class="pre">prms_python.util.calc_emp_CDF</span></code> and <code class="docutils literal notranslate"><span class="pre">prms_python.util.Kolmogorov_Smirnov</span></code> functions. These functions can be used to easily calculate the PAWN sensitivity analysis from the results produced using the template above.</p>
</div>
</div>


           </div>
           
          </div>
          <!-- 
This file modifies the default sphinx_rtd_theme footer
-->



<footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  <!-- your html code here -->


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>